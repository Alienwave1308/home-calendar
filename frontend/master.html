<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, viewport-fit=cover">
  <meta name="theme-color" content="#2f9f68">
  <title>–ü–∞–Ω–µ–ª—å –º–∞—Å—Ç–µ—Ä–∞</title>
  <link rel="stylesheet" href="booking.css">
  <link rel="stylesheet" href="master.css">
</head>
<body>
  <div id="app">
    <div class="master-header">
      <h1>–ü–∞–Ω–µ–ª—å –º–∞—Å—Ç–µ—Ä–∞</h1>
      <button class="btn-back" id="btnLogout" onclick="MasterApp.logout()">–í—ã–π—Ç–∏</button>
    </div>

    <!-- Tabs -->
    <nav class="master-tabs" id="masterTabs">
      <button class="master-tab active" data-tab="today" onclick="MasterApp.switchTab('today')">–°–µ–≥–æ–¥–Ω—è</button>
      <button class="master-tab" data-tab="bookings" onclick="MasterApp.switchTab('bookings')">–ó–∞–ø–∏—Å–∏</button>
      <button class="master-tab" data-tab="leads" onclick="MasterApp.switchTab('leads')">–õ–∏–¥—ã</button>
      <button class="master-tab" data-tab="services" onclick="MasterApp.switchTab('services')">–£—Å–ª—É–≥–∏</button>
      <button class="master-tab" data-tab="settings" onclick="MasterApp.switchTab('settings')">–ù–∞—Å—Ç—Ä–æ–π–∫–∏</button>
    </nav>

    <!-- Tab: Today -->
    <section class="tab-panel" id="tabToday">
      <div id="todayBookings" class="bookings-list"></div>
      <div id="todayEmpty" class="empty-state" style="display:none;">
        <div class="empty-icon">üéâ</div>
        <p>–ù–∞ —Å–µ–≥–æ–¥–Ω—è –∑–∞–ø–∏—Å–µ–π –Ω–µ—Ç</p>
        <p class="empty-hint">–ü–æ–¥–µ–ª–∏—Ç–µ—Å—å —Å—Å—ã–ª–∫–æ–π –¥–ª—è –∑–∞–ø–∏—Å–∏ —Å –∫–ª–∏–µ–Ω—Ç–∞–º–∏</p>
      </div>
    </section>

    <!-- Tab: Bookings -->
    <section class="tab-panel" id="tabBookings" style="display:none;">
      <div class="bookings-filters">
        <button class="btn-primary btn-create-booking" onclick="MasterApp.openBookingForm()">–°–æ–∑–¥–∞—Ç—å –∑–∞–ø–∏—Å—å</button>
        <select id="bookingsStatus" onchange="MasterApp.loadBookings()">
          <option value="">–í—Å–µ —Å—Ç–∞—Ç—É—Å—ã</option>
          <option value="pending">–û–∂–∏–¥–∞—é—Ç</option>
          <option value="confirmed">–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω—ã</option>
          <option value="completed">–ó–∞–≤–µ—Ä—à–µ–Ω—ã</option>
          <option value="canceled">–û—Ç–º–µ–Ω–µ–Ω—ã</option>
        </select>
      </div>
      <div id="bookingsList" class="bookings-list"></div>
      <div id="bookingsEmpty" class="empty-state" style="display:none;">
        <div class="empty-icon">üìÖ</div>
        <p>–ó–∞–ø–∏—Å–µ–π –Ω–µ –Ω–∞–π–¥–µ–Ω–æ</p>
      </div>
    </section>

    <!-- Tab: Leads -->
    <section class="tab-panel" id="tabLeads" style="display:none;">
      <div class="leads-help-toggle-row">
        <button
          id="leadsHelpToggleBtn"
          class="btn-secondary"
          type="button"
          aria-expanded="false"
          onclick="MasterApp.toggleLeadsHelp()"
        >
          –ü–æ–¥—Å–∫–∞–∑–∫–∏
        </button>
      </div>
      <div id="leadsHelpPanel" class="settings-card leads-help-panel" style="display:none;">
        <h3>–ö–∞–∫ —á–∏—Ç–∞—Ç—å –ø–æ–∫–∞–∑–∞—Ç–µ–ª–∏</h3>
        <p><strong>–ó–∞—à–ª–∏ –≤ –±–æ—Ç–∞</strong> ‚Äî —Å–∫–æ–ª—å–∫–æ –Ω–æ–≤—ã—Ö –ª—é–¥–µ–π –ø—Ä–∏—à–ª–æ. –í–ª–∏—è–µ—Ç –Ω–∞ –ø–æ—Ç–æ–∫ –Ω–æ–≤—ã—Ö –∫–ª–∏–µ–Ω—Ç–æ–≤.</p>
        <p><strong>–ù–∞—á–∞–ª–∏ / –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–ª–∏—Å—å</strong> ‚Äî —Å–∫–æ–ª—å–∫–æ –ª—é–¥–µ–π –¥–æ—à–ª–∏ –¥–æ –≤—Ö–æ–¥–∞. –ï—Å–ª–∏ –ø—Ä–æ—Å–µ–¥–∞–µ—Ç: —É–ø—Ä–æ—Å—Ç–∏—Ç—å —à–∞–≥–∏ –∏ —Ç–µ–∫—Å—Ç.</p>
        <p><strong>–ù–∞—á–∞–ª–∏ –∑–∞–ø–∏—Å—å</strong> ‚Äî —Å–∫–æ–ª—å–∫–æ –ª—é–¥–µ–π –≤—ã–±—Ä–∞–ª–∏ —É—Å–ª—É–≥—É –∏ —Å–ª–æ—Ç. –ï—Å–ª–∏ –º–∞–ª–æ: –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —Ü–µ–Ω—ã, –Ω–∞–∑–≤–∞–Ω–∏—è, —É–¥–æ–±–Ω—ã–µ –æ–∫–Ω–∞.</p>
        <p><strong>–°–æ–∑–¥–∞–ª–∏ –∑–∞–ø–∏—Å—å</strong> ‚Äî —Å–∫–æ–ª—å–∫–æ –¥–æ—à–ª–∏ –¥–æ —Ñ–∏–Ω–∞–ª—å–Ω–æ–≥–æ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è. –≠—Ç–æ –∫–ª—é—á–µ–≤–∞—è –º–µ—Ç—Ä–∏–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏.</p>
        <p><strong>–í–æ—Ä–æ–Ω–∫–∞</strong> ‚Äî –≥–¥–µ —Ç–µ—Ä—è—é—Ç—Å—è –ª—é–¥–∏ –º–µ–∂–¥—É —à–∞–≥–∞–º–∏. –°–º–æ—Ç—Ä–∏—Ç–µ, –≥–¥–µ —Å–∞–º—ã–π –Ω–∏–∑–∫–∏–π –ø—Ä–æ—Ü–µ–Ω—Ç.</p>
      </div>
      <div class="leads-period-tabs">
        <button class="service-tab active" data-leads-period="day" onclick="MasterApp.setLeadsPeriod('day')">–î–µ–Ω—å</button>
        <button class="service-tab" data-leads-period="week" onclick="MasterApp.setLeadsPeriod('week')">–ù–µ–¥–µ–ª—è</button>
        <button class="service-tab" data-leads-period="month" onclick="MasterApp.setLeadsPeriod('month')">–ú–µ—Å—è—Ü</button>
      </div>
      <div class="leads-kpi-grid">
        <article class="settings-card leads-kpi-card">
          <p>–ó–∞—à–ª–∏ –≤ –±–æ—Ç–∞</p>
          <strong id="leadsVisitors">0</strong>
          <span id="leadsVisitorsDelta">‚Äî</span>
        </article>
        <article class="settings-card leads-kpi-card">
          <p>–ù–∞—á–∞–ª–∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é</p>
          <strong id="leadsAuthStarted">0</strong>
          <span id="leadsAuthStartedDelta">‚Äî</span>
        </article>
        <article class="settings-card leads-kpi-card">
          <p>–ê–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–ª–∏—Å—å</p>
          <strong id="leadsAuthSuccess">0</strong>
          <span id="leadsAuthSuccessDelta">‚Äî</span>
        </article>
        <article class="settings-card leads-kpi-card">
          <p>–ù–∞—á–∞–ª–∏ –∑–∞–ø–∏—Å—å</p>
          <strong id="leadsBookingStarted">0</strong>
          <span id="leadsBookingStartedDelta">‚Äî</span>
        </article>
        <article class="settings-card leads-kpi-card">
          <p>–°–æ–∑–¥–∞–ª–∏ –∑–∞–ø–∏—Å—å</p>
          <strong id="leadsBookingCreated">0</strong>
          <span id="leadsBookingCreatedDelta">‚Äî</span>
        </article>
      </div>
      <div class="settings-card">
        <h3>–í–æ—Ä–æ–Ω–∫–∞</h3>
        <div id="leadsFunnel" class="leads-funnel"></div>
      </div>
      <div class="settings-card">
        <h3>–ü–µ—Ä–∏–æ–¥</h3>
        <div id="leadsRangeLabel" class="settings-hint">‚Äî</div>
        <p class="settings-hint" style="margin-top:8px;">–ú–µ—Ç—Ä–∏–∫–∏ —Å—á–∏—Ç–∞—é—Ç—Å—è –ø–æ —Ç–µ–∫—É—â–∏–º –¥–∞–Ω–Ω—ã–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∏ –∑–∞–ø–∏—Å–µ–π (proxy).</p>
      </div>
    </section>

    <!-- Tab: Services -->
    <section class="tab-panel" id="tabServices" style="display:none;">
      <div class="service-tabs">
        <button class="service-tab active" data-method="all" onclick="MasterApp.setServiceMethodFilter('all')">–í—Å–µ</button>
        <button class="service-tab" data-method="sugar" onclick="MasterApp.setServiceMethodFilter('sugar')">–°–∞—Ö–∞—Ä</button>
        <button class="service-tab" data-method="wax" onclick="MasterApp.setServiceMethodFilter('wax')">–í–æ—Å–∫</button>
      </div>
      <div class="service-tabs service-subtabs">
        <button class="service-tab active" data-category="all" onclick="MasterApp.setServiceCategoryFilter('all')">–í—Å–µ</button>
        <button class="service-tab" data-category="–£—Å–ª—É–≥–∏" onclick="MasterApp.setServiceCategoryFilter('–£—Å–ª—É–≥–∏')">–ó–æ–Ω—ã</button>
        <button class="service-tab" data-category="–ö–æ–º–ø–ª–µ–∫—Å—ã" onclick="MasterApp.setServiceCategoryFilter('–ö–æ–º–ø–ª–µ–∫—Å—ã')">–ö–æ–º–ø–ª–µ–∫—Å—ã</button>
      </div>
      <div id="servicesList" class="services-list"></div>
      <div id="servicesEmpty" class="empty-state" style="display:none;">
        <div class="empty-icon">üíá</div>
        <p>–î–æ–±–∞–≤—å—Ç–µ —Å–≤–æ—é –ø–µ—Ä–≤—É—é —É—Å–ª—É–≥—É</p>
        <button class="btn-secondary" style="margin-top:10px;" onclick="MasterApp.bootstrapDefaultServices()">
          –ó–∞–ø–æ–ª–Ω–∏—Ç—å –ø—Ä–∞–π—Å –ø–æ —à–∞–±–ª–æ–Ω—É
        </button>
      </div>
      <button class="btn-primary" style="margin-top:16px;" onclick="MasterApp.showAddService()">–î–æ–±–∞–≤–∏—Ç—å —É—Å–ª—É–≥—É</button>
      <button class="btn-secondary" style="margin-top:10px;" onclick="MasterApp.bootstrapDefaultServices()">
        –ó–∞–ø–æ–ª–Ω–∏—Ç—å –ø—Ä–∞–π—Å –ø–æ —à–∞–±–ª–æ–Ω—É
      </button>
    </section>

    <!-- Tab: Settings -->
    <section class="tab-panel" id="tabSettings" style="display:none;">
      <div class="settings-card">
        <h3>–°—Å—ã–ª–∫–∞ –¥–ª—è –∑–∞–ø–∏—Å–∏</h3>
        <div class="link-copy-row">
          <input type="text" id="bookingLink" readonly class="link-input">
          <button class="btn-secondary btn-copy" onclick="MasterApp.copyLink()">–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å</button>
        </div>
      </div>
      <div class="settings-card">
        <h3>Google Calendar</h3>
        <div id="gcalStatus" class="gcal-status"></div>
      </div>
      <div class="settings-card">
        <h3>Apple Calendar</h3>
        <div id="appleCalStatus" class="gcal-status">–ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞...</div>
        <div id="appleCalLinkRow" class="link-copy-row" style="display:none; margin-top:8px;">
          <input type="text" id="appleCalendarLink" readonly class="link-input">
          <button class="btn-secondary btn-copy" onclick="MasterApp.copyAppleLink()">–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å</button>
        </div>
        <button id="appleCalendarOpenBtn" class="btn-secondary btn-open-apple" onclick="MasterApp.openAppleCalendar()" style="display:none; margin-top:8px;">
          –û—Ç–∫—Ä—ã—Ç—å –≤ Apple Calendar
        </button>
        <div class="apple-actions">
          <button class="btn-secondary" onclick="MasterApp.enableAppleCalendar()">–í–∫–ª—é—á–∏—Ç—å</button>
          <button class="btn-secondary" onclick="MasterApp.rotateAppleCalendar()">–û–±–Ω–æ–≤–∏—Ç—å —Å—Å—ã–ª–∫—É</button>
          <button class="btn-secondary" onclick="MasterApp.disableAppleCalendar()">–û—Ç–∫–ª—é—á–∏—Ç—å</button>
        </div>
      </div>
      <div class="settings-card">
        <h3>–ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è</h3>
        <div id="reminderSettings"></div>
        <div class="availability-form">
          <input id="reminderHoursFirst" type="number" min="1" max="168" value="24" placeholder="–ü–µ—Ä–≤–æ–µ, —á–∞—Å–æ–≤">
          <input id="reminderHoursSecond" type="number" min="1" max="168" value="2" placeholder="–í—Ç–æ—Ä–æ–µ, —á–∞—Å–æ–≤">
          <button class="btn-secondary" onclick="MasterApp.saveReminderSettings()">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è</button>
        </div>
        <div class="availability-form">
          <input id="minBookingNoticeMinutes" type="number" min="0" max="1440" value="60" placeholder="–ú–∏–Ω–∏–º—É–º –¥–æ –∑–∞–ø–∏—Å–∏, –º–∏–Ω—É—Ç">
          <input id="firstVisitDiscountPercent" type="number" min="0" max="90" value="15" placeholder="–°–∫–∏–¥–∫–∞ –Ω–∞ –ø–µ—Ä–≤—ã–π –≤–∏–∑–∏—Ç, %">
          <button class="btn-secondary" onclick="MasterApp.savePricingSettings()">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –∏ —Å–∫–∏–¥–∫—É</button>
        </div>
      </div>
      <div class="settings-card">
        <h3>–°–≤–æ–±–æ–¥–Ω—ã–µ –æ–∫–Ω–∞ –¥–ª—è –∑–∞–ø–∏—Å–∏</h3>
        <p class="settings-hint">–î–æ–±–∞–≤—å—Ç–µ —Ä–∞–±–æ—á–∏–µ –∏–Ω—Ç–µ—Ä–≤–∞–ª—ã –ø–æ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–º –¥–∞—Ç–∞–º. –®–∞–≥ –∑–∞–ø–∏—Å–∏ —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω: 10 –º–∏–Ω—É—Ç.</p>
        <div class="availability-form">
          <input id="availabilityDate" type="date">
          <input id="availabilityStart" type="time" value="10:00">
          <input id="availabilityEnd" type="time" value="20:00">
          <button class="btn-secondary" onclick="MasterApp.addAvailabilityRule()">–î–æ–±–∞–≤–∏—Ç—å –æ–∫–Ω–æ</button>
        </div>
        <div id="availabilityRules" class="settings-list"></div>

        <div class="availability-exclusions">
          <h4>–í—ã—Ö–æ–¥–Ω—ã–µ –¥–∞—Ç—ã</h4>
          <div class="availability-form">
            <input id="availabilityExclusionDate" type="date">
            <input id="availabilityExclusionReason" type="text" placeholder="–ü—Ä–∏—á–∏–Ω–∞ (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)">
            <button class="btn-secondary" onclick="MasterApp.addAvailabilityExclusion()">–î–æ–±–∞–≤–∏—Ç—å –¥–∞—Ç—É</button>
          </div>
          <div id="availabilityExclusions" class="settings-list"></div>
        </div>
      </div>
    </section>

    <!-- Network toast (reused from booking.css) -->
    <div id="networkToast" class="network-toast" style="display:none;">
      <span id="networkToastText"></span>
      <button class="toast-close" onclick="MasterApp.hideToast()">&times;</button>
    </div>
  </div>

  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <script src="master.js"></script>
</body>
</html>
